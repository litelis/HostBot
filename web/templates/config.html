<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HostBot - Configuraci√≥n</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/animations.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Background -->
    <div class="bg-grid"></div>
    <div class="bg-glow"></div>
    
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-brand">
            <div class="logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
            </div>
            <span class="brand-text">HostBot</span>
            <span class="version">v2.0</span>
        </div>
        
        <div class="nav-links">
            <a href="/" class="nav-link">Dashboard</a>
            <a href="/config" class="nav-link active">Configuraci√≥n</a>
            <a href="/setup" class="nav-link">Setup Wizard</a>
        </div>
        
        <div class="nav-status">
            <div class="status-indicator" id="agentStatus">
                <span class="status-dot"></span>
                <span class="status-text">Conectando...</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-container">
        <div class="dashboard-grid" style="grid-template-columns: 1fr;">
            <div class="column-left">
                <!-- Discord Configuration -->
                <section class="config-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                            </svg>
                            Discord Bot
                        </h2>
                        <span class="badge badge-primary" id="discordStatus">Verificando...</span>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Discord Bot Token</label>
                        <div class="input-wrapper">
                            <input type="password" id="discordToken" class="form-input" placeholder="No configurado">
                            <button type="button" class="input-action" onclick="togglePassword('discordToken')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Admin User ID</label>
                        <input type="text" id="adminUserId" class="form-input" placeholder="No configurado">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Guild ID (Opcional)</label>
                        <input type="text" id="guildId" class="form-input" placeholder="No configurado">
                    </div>
                </section>

                <!-- Ollama Configuration -->
                <section class="config-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2a10 10 0 1 0 10 10H12V2z"/>
                                <path d="M12 2a10 10 0 0 1 10 10"/>
                                <path d="M12 12L2.5 12"/>
                            </svg>
                            Ollama AI
                        </h2>
                        <span class="badge badge-primary" id="ollamaStatus">Verificando...</span>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ollama Host</label>
                        <input type="text" id="ollamaHost" class="form-input" value="http://localhost:11434">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Modelo Principal</label>
                        <select id="ollamaModel" class="form-select">
                            <option value="llama3.2">Llama 3.2</option>
                            <option value="llama3.1">Llama 3.1</option>
                            <option value="mistral">Mistral</option>
                            <option value="codellama">CodeLlama</option>
                            <option value="llava">LLaVA (con visi√≥n)</option>
                        </select>
                    </div>
                    
                    <div class="connection-test">
                        <button type="button" class="btn-secondary" onclick="testOllama()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            Probar Conexi√≥n
                        </button>
                        <span class="test-result" id="ollamaTestResult"></span>
                    </div>
                </section>

                <!-- Security Settings -->
                <section class="config-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            </svg>
                            Seguridad
                        </h2>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Modo de Seguridad</label>
                        <select id="safetyMode" class="form-select">
                            <option value="strict">Estricto (Todas las acciones requieren confirmaci√≥n)</option>
                            <option value="moderate">Moderado (Solo cr√≠ticas requieren confirmaci√≥n)</option>
                            <option value="minimal">M√≠nimo (M√°xima autonom√≠a)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">C√≥digo de Emergencia</label>
                        <div class="input-wrapper">
                            <input type="text" id="emergencyCode" class="form-input" value="STOP123">
                            <button type="button" class="input-action" onclick="generateNewCode()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"/>
                                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Permissions -->
                <section class="config-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                <path d="M12 8v4"/>
                                <path d="M12 16h.01"/>
                            </svg>
                            Permisos del Sistema
                        </h2>
                    </div>
                    
                    <div class="permissions-grid">
                        <label class="permission-card">
                            <input type="checkbox" id="allowDesktop" checked>
                            <div class="permission-content">
                                <div class="permission-icon">üñ±Ô∏è</div>
                                <div class="permission-title">Control de Escritorio</div>
                                <div class="permission-desc">Rat√≥n y teclado</div>
                            </div>
                        </label>

                        <label class="permission-card">
                            <input type="checkbox" id="allowSystem" checked>
                            <div class="permission-content">
                                <div class="permission-icon">‚ö°</div>
                                <div class="permission-title">Comandos del Sistema</div>
                                <div class="permission-desc">Terminal y scripts</div>
                            </div>
                        </label>

                        <label class="permission-card">
                            <input type="checkbox" id="allowBrowser" checked>
                            <div class="permission-content">
                                <div class="permission-icon">üåê</div>
                                <div class="permission-title">Automatizaci√≥n Web</div>
                                <div class="permission-desc">Navegador web</div>
                            </div>
                        </label>

                        <label class="permission-card">
                            <input type="checkbox" id="allowInstall">
                            <div class="permission-content">
                                <div class="permission-icon">üì¶</div>
                                <div class="permission-title">Instalaci√≥n de Software</div>
                                <div class="permission-desc">Instalar/desinstalar</div>
                            </div>
                        </label>
                    </div>
                </section>

                <!-- Save Button -->
                <div class="form-actions">
                    <button type="button" class="btn-success btn-lg" onclick="saveConfig()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17 21 17 13 7 13 7 21"/>
                            <polyline points="7 3 7 8 15 8"/>
                        </svg>
                        Guardar Configuraci√≥n
                    </button>
                    <button type="button" class="btn-secondary" onclick="resetConfig()">
                        Restaurar Valores
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="/static/js/api.js"></script>
    <script>
        // Load current configuration
        async function loadConfig() {
            try {
                const result = await api.getConfigStatus();
                
                if (result.success) {
                    const values = result.current_values;
                    
                    // Fill form fields
                    if (values.discord_token) {
                        document.getElementById('discordToken').value = values.discord_token;
                    }
                    if (values.discord_admin_user_id) {
                        document.getElementById('adminUserId').value = values.discord_admin_user_id;
                    }
                    if (values.discord_guild_id) {
                        document.getElementById('guildId').value = values.discord_guild_id;
                    }
                    if (values.ollama_host) {
                        document.getElementById('ollamaHost').value = values.ollama_host;
                    }
                    if (values.ollama_model) {
                        document.getElementById('ollamaModel').value = values.ollama_model;
                    }
                    if (values.safety_mode) {
                        document.getElementById('safetyMode').value = values.safety_mode;
                    }
                    
                    // Checkboxes
                    document.getElementById('allowDesktop').checked = values.allow_desktop_control;
                    document.getElementById('allowSystem').checked = values.allow_system_commands;
                    document.getElementById('allowBrowser').checked = values.allow_browser_automation;
                    document.getElementById('allowInstall').checked = values.allow_software_installation;
                    
                    // Update status badges
                    updateStatusBadges(result.configured, result.missing);
                }
            } catch (error) {
                showToast('Error al cargar configuraci√≥n', 'error');
            }
        }

        function updateStatusBadges(configured, missing) {
            const discordBadge = document.getElementById('discordStatus');
            const ollamaBadge = document.getElementById('ollamaStatus');
            
            if (configured) {
                discordBadge.className = 'badge badge-success';
                discordBadge.textContent = '‚úì Configurado';
                ollamaBadge.className = 'badge badge-success';
                ollamaBadge.textContent = '‚úì Configurado';
            } else {
                discordBadge.className = 'badge badge-warning';
                discordBadge.textContent = '‚ö†Ô∏è Requerido';
                ollamaBadge.className = 'badge badge-warning';
                ollamaBadge.textContent = '‚ö†Ô∏è Verificar';
            }
        }

        async function saveConfig() {
            const config = {
                discord_token: document.getElementById('discordToken').value,
                discord_admin_user_id: document.getElementById('adminUserId').value,
                ollama_model: document.getElementById('ollamaModel').value,
                ollama_host: document.getElementById('ollamaHost').value,
                safety_mode: document.getElementById('safetyMode').value,
                allow_desktop_control: document.getElementById('allowDesktop').checked,
                allow_system_commands: document.getElementById('allowSystem').checked,
                allow_browser_automation: document.getElementById('allowBrowser').checked,
                allow_software_installation: document.getElementById('allowInstall').checked
            };
            
            const guildId = document.getElementById('guildId').value;
            if (guildId) {
                config.discord_guild_id = guildId;
            }
            
            try {
                const result = await api.updateConfig(config);
                
                if (result.success) {
                    showToast('Configuraci√≥n guardada exitosamente', 'success');
                } else {
                    showToast('Error: ' + result.error, 'error');
                }
            } catch (error) {
                showToast('Error de conexi√≥n', 'error');
            }
        }

        function resetConfig() {
            if (confirm('¬øRestaurar valores originales? Los cambios no guardados se perder√°n.')) {
                loadConfig();
                showToast('Valores restaurados', 'info');
            }
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        function generateNewCode() {
            const code = 'STOP' + Math.random().toString(36).substring(2, 7).toUpperCase();
            document.getElementById('emergencyCode').value = code;
            showToast('Nuevo c√≥digo generado', 'success');
        }

        async function testOllama() {
            const resultEl = document.getElementById('ollamaTestResult');
            resultEl.textContent = 'Probando...';
            resultEl.className = 'test-result testing';
            
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                if (data.success) {
                    resultEl.textContent = '‚úì Conectado';
                    resultEl.className = 'test-result success';
                } else {
                    resultEl.textContent = '‚úó No conectado';
                    resultEl.className = 'test-result error';
                }
            } catch (error) {
                resultEl.textContent = '‚úó Error';
                resultEl.className = 'test-result error';
            }
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', loadConfig);
    </script>
</body>
</html>
